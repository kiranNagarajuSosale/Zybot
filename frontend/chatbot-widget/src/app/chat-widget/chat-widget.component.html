<div class="chat-button" *ngIf="!domContextEnabled" (click)="toggleChat()">
  üí¨
</div>
<div class="chat-window" *ngIf="isOpen">
  <div class="chat-header">
    <div class="chat-header-title">
      <span>ZyBot</span>
    </div>
    <div class="dom-context-toggle">
      <label for="domContextToggle" class="switch">
        <input id="domContextToggle" type="checkbox" (change)="toggleDomContext()" />
        <span class="slider"></span>
      </label>
      <span class="toggle-label" style="font-size: 10px;">DOM Context</span>
    </div>
    <div class="model-select" style="display:inline-block;">
      <label for="modelDropdown" style="font-size: 12px;">Choose Model:</label>
      <select id="modelDropdown" [(ngModel)]="selectedModel" (change)="onModelChange($event)" style="font-size: 10px;">
        <option *ngFor="let model of models" [value]="model">{{ model }}</option>
      </select>
    </div>
    <div class="role-select" style="display:inline-block; margin-left:5px;">
      <label for="roleDropdown" style="font-size: 12px;">Role:</label>
      <select id="roleDropdown" [(ngModel)]="selectedRole" style="font-size: 10px;">
        <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
      </select>
    </div>
    
    <button (click)="toggleChat()">‚úñ</button>
  </div>

  <div class="chat-body" #chatBody>
    <!-- Show DOM content at the top only when there are no messages -->
    <div *ngIf="selectedDomContent && messages.length === 0" class="dom-context-preview">
      <div class="preview-header">Selected Content:</div>
      <div class="preview-content">{{ selectedDomContent }}</div>
      <div *ngIf="selectedDomData" class="preview-details">
        <div class="details-header">
          <strong>DOM Details</strong>
          <button class="send-dom-btn" (click)="clearDomDetails()" title="Clear DOM details">ÔøΩÔ∏è</button>
        </div>
        <div><strong>Tag:</strong> {{ selectedDomData.tagName }}</div>
        <div *ngIf="selectedDomData.id"><strong>ID:</strong> {{ selectedDomData.id }}</div>
        <div *ngIf="selectedDomData.className"><strong>Class:</strong> {{ selectedDomData.className }}</div>
      </div>
    </div>
    <div *ngFor="let msg of messages" [ngClass]="msg.sender">
      <div *ngIf="msg.format === 'html'" [innerHTML]="msg.text"></div>
      <div *ngIf="msg.format !== 'html'">{{ msg.text }}</div>
    </div>
    <!-- Show DOM content after messages when there are messages -->
    <div *ngIf="selectedDomContent && messages.length > 0" class="dom-context-preview">
      <div class="preview-header">Selected Content:</div>
      <div class="preview-content">{{ selectedDomContent }}</div>
      <div *ngIf="selectedDomData" class="preview-details">
        <div class="details-header">
          <strong>DOM Details</strong>
          <button class="send-dom-btn" (click)="clearDomDetails()" title="Clear DOM details">ÔøΩÔ∏è</button>
        </div>
        <div><strong>Tag:</strong> {{ selectedDomData.tagName }}</div>
        <div *ngIf="selectedDomData.id"><strong>ID:</strong> {{ selectedDomData.id }}</div>
        <div *ngIf="selectedDomData.className"><strong>Class:</strong> {{ selectedDomData.className }}</div>
      </div>
    </div>
    <div *ngIf="isLoading" class="typing-loader">
      <span></span><span></span><span></span>
    </div>
  </div>

  <div class="chat-footer" [ngClass]="{'typing-loader': isLoading}">
    <input [(ngModel)]="userInput" (keyup.enter)="sendMessage()" [disabled]="isLoading"
      [placeholder]="isLoading ? 'Zybot is thinking... üí¨' : 'Type a message...'" />
    <button (click)="clearChat()" title="Clear chat history and selected content" [disabled]="isLoading || ((!selectedDomContent) && messages.length === 0)">üóëÔ∏è</button>
    <button (click)="sendMessage()" [disabled]="isLoading || !userInput">Send</button>
  </div>
</div>